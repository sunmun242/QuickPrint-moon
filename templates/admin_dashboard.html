<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | Quick Moon Print</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"> 
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7f6; }
        .dashboard-container { max-width: 1200px; margin: 20px auto; padding: 20px; background-color: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
        h1 { border-bottom: 2px solid #ccc; padding-bottom: 10px; margin-bottom: 20px; }
        .summary-cards { display: flex; justify-content: space-between; margin-bottom: 30px; flex-wrap: wrap; }
        .card { background-color: #f0f8ff; border: 1px solid #e0e0e0; border-radius: 6px; padding: 20px; width: 23%; min-width: 200px; margin-bottom: 15px; }
        .card h3 { margin-top: 0; color: #007bff; font-size: 1.1em; }
        .card p { font-size: 2em; font-weight: bold; color: #333; margin: 5px 0 0; }
        .report-section { margin-top: 40px; }
        .report-section h2 { border-bottom: 1px solid #eee; padding-bottom: 5px; margin-bottom: 15px; font-size: 1.5em; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; word-break: break-all; }
        th { background-color: #f2f2f2; font-weight: bold; }
        .btn-logout { background-color: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 4px; text-decoration: none; float: right; margin-top: -50px; }
        
        /* Filter Styles */
        .filter-box { background-color: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; align-items: center; }
        .filter-box label { font-weight: bold; }
        .filter-box input[type="date"] { padding: 8px; border: 1px solid #ccc; border-radius: 4px; }
        .filter-box button { padding: 8px 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <h1>Admin Dashboard - Sales Overview</h1>
        <a href="{{ url_for('admin_logout') }}" class="btn-logout">Logout</a>

        <div class="summary-cards">
            <div class="card">
                <h3>üí∞ Total Income (Filtered)</h3>
                <p>‚Çπ {{ "{:.2f}".format(total_income) }}</p>
            </div>
            <div class="card">
                <h3>üìÖ Today's Income</h3>
                <p>‚Çπ {{ "{:.2f}".format(today_income) }}</p>
            </div>
            <div class="card">
                <h3>üóìÔ∏è Current Month Income</h3>
                <p>‚Çπ {{ "{:.2f}".format(current_month_income) }}</p>
            </div>
            <div class="card">
                <h3>‚èÆÔ∏è Last Month Income</h3>
                <p>‚Çπ {{ "{:.2f}".format(last_month_income) }}</p>
            </div>
        </div>

        <div class="filter-box">
            <form method="GET" action="{{ url_for('admin_dashboard') }}" style="display: flex; gap: 15px; align-items: center;">
                <label for="start_date">Filter Transactions from:</label>
                <input type="date" id="start_date" name="start_date" value="{{ filter_start_date or '' }}">
                <label for="end_date">to</label>
                <input type="date" id="end_date" name="end_date" value="{{ filter_end_date or '' }}">
                <button type="submit">Apply Filter</button>
                <a href="{{ url_for('admin_dashboard') }}" style="text-decoration: none; color: #dc3545; font-weight: bold;">Reset Filter</a>
            </form>
        </div>


        <div class="report-section">
            <h2>Monthly Sales Breakdown (Filtered)</h2>
            {% if monthly_sales %}
                <table>
                    <thead>
                        <tr>
                            <th>Month</th>
                            <th>Income (‚Çπ)</th>
                            <th>Total Orders</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for month, data in monthly_sales.items() %}
                        <tr>
                            <td>{{ month }}</td>
                            <td>{{ "{:.2f}".format(data.income) }}</td>
                            <td>{{ data.orders }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No monthly sales data available for this period.</p>
            {% endif %}
        </div>
        
        <div class="report-section">
            <h2>All Transactions (Completed/Printed)</h2>
            {% if transactions %}
                <table>
                    <thead>
                        <tr>
                            <th>Date/Time</th>
                            <th>Order ID</th>
                            <th>Transaction Ref ID</th>
                            <th>UTR/UPI ID</th>
                            <th>Cost (‚Çπ)</th>
                            <th>Copies</th>
                            <th>Mode</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for tx in transactions | reverse %}
                        {% if tx.status == 'COMPLETED' or tx.status == 'PRINTED' %}
                        <tr>
                            <td>{{ tx.created_at.split('T')[0] }}<br>({{ tx.created_at.split('T')[1].split('.')[0] }})</td>
                            <td>{{ tx.id[:8] }}...</td>
                            <td>{{ tx.transaction_ref_id or 'N/A' }}</td>
                            <td>{{ tx.utr_id or 'N/A' }}</td>
                            <td>{{ "{:.2f}".format(tx.cost) }}</td>
                            <td>{{ tx.copies }}</td>
                            <td>{{ tx.print_mode or 'N/A' }}</td>
                            <td>{{ tx.status }}</td>
                        </tr>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>
            {% else %}
                <p>No completed transactions available in this period.</p>
            {% endif %}
        </div>

    </div>
</body>
</html>