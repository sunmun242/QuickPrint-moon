<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Status | Quick Moon Print</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        .status-box {
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            margin: 50px auto;
            max-width: 600px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        .status-success {
            background-color: #e6ffed;
            border: 2px solid #28a745;
            color: #1e7e34;
        }
        .status-failed {
            background-color: #ffeaea;
            border: 2px solid #dc3545;
            color: #dc3545;
        }
        .status-processing {
            /* Neutral color for processing state */
            background-color: #fff9e6;
            border: 2px solid #ffc107;
            color: #856404;
        }
        .status-box h2 {
            margin-top: 0;
            font-size: 2em;
        }
        .status-box p {
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <header class="top-bar">
        <div class="header-content">
            <h1 class="logo">Quick Moon Print</h1>
        </div>
    </header> 


    <div class="container main-steps">
        {# Handle SUCCESS/COMPLETED status #}
        {% if status == 'SUCCESS' or status == 'COMPLETED' %}
        <div class="status-box status-success">
            <h2>üéâ Transaction Successful & Print Job Started!</h2>
            <p>**{{ message }}**</p>
            <p>Your print job has been successfully queued and should be available shortly. Please collect your printout from the machine.</p>
            <a href="{{ url_for('index') }}" class="primary-button" style="background-color: #007bff; margin-top: 20px;">Place New Order</a>
        </div>

        {# Handle FAILED status #}
        {% elif status == 'FAILED' %}
        <div class="status-box status-failed">
            <h2>‚ùå Transaction Failed</h2>
            <p>**{{ message }}**</p>
            <p>Your payment attempt was unsuccessful. Please check your payment details and try again.</p>
            <a href="{{ url_for('index') }}" class="primary-button" style="background-color: #6c757d; margin-top: 20px;">Try Again</a>
            <a href="https://wa.me/917063312134" target="_blank" class="primary-button" style="margin-top: 10px; background-color: #28a745;">WhatsApp Support</a>
        </div>
        
        {# Handle PROCESSING (default) status - This is likely the state causing confusion #}
        {% else %}
        <div class="status-box status-processing">
            <h2>‚è≥ Payment Status: Processing</h2>
            <p>**{{ message }}**</p>
            <p>We are waiting for final confirmation from PhonePe. If the payment was successful, the Webhook will confirm it shortly, and your print job will start. If your money was deducted, and the status doesn't change, please contact support.</p>
            
            <a href="{{ url_for('index') }}" class="primary-button" style="background-color: #007bff; margin-top: 20px;">Go to Homepage</a>
            <a href="https://wa.me/917063312134" target="_blank" class="primary-button" style="margin-top: 10px; background-color: #28a745;">WhatsApp Support</a>
        </div>
        {% endif %}
    </div>


    <footer>
        <div class="footer-content">
            <p>&copy; 2025 Quick Moon Print. All rights reserved. | Contact: 7063312134</p>
            <div class="footer-links">
                <a href="{{ url_for('about') }}">About Us</a> |
                <a href="https://wa.me/917063312134" target="_blank">WhatsApp Support</a> |
                <a href="{{ url_for('terms') }}" target="_blank">Terms and Conditions</a> |
                <a href="{{ url_for('refund') }}" target="_blank">Refund Policy</a> |
                <a href="{{ url_for('privacy') }}" target="_blank">Privacy Policy</a>
            </div>
        </div>
    </footer>
</body>
</html>